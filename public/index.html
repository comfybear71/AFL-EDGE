<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>AFL Edge — Season Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800;900&family=Barlow:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #06090e;
    --surface: #0c1017;
    --card: #111822;
    --card-hover: #151d2a;
    --border: #1a2332;
    --border-light: #243044;
    --accent: #00c8ff;
    --accent-dim: rgba(0, 200, 255, 0.12);
    --accent-glow: rgba(0, 200, 255, 0.25);
    --accent2: #ff6b35;
    --green: #00e676;
    --green-dim: rgba(0, 230, 118, 0.12);
    --yellow: #ffd600;
    --yellow-dim: rgba(255, 214, 0, 0.12);
    --red: #ff4444;
    --red-dim: rgba(255, 68, 68, 0.1);
    --text: #e8edf5;
    --text-secondary: #a0aec0;
    --muted: #5a6478;
    --label: #8a94a8;
    --radius: 14px;
    --radius-sm: 10px;
    --radius-xs: 6px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Barlow', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     HEADER
     ═══════════════════════════════════════════════════════════════════════════ */
  header {
    background: linear-gradient(180deg, rgba(6,9,14,0.98) 0%, rgba(6,9,14,0.85) 100%);
    padding: 14px 16px 0;
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border);
  }

  .header-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
  }

  .logo {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 26px;
    letter-spacing: -0.5px;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .logo span { color: var(--accent); }

  .logo-icon {
    width: 28px;
    height: 28px;
    background: linear-gradient(135deg, var(--accent), #0090cc);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: #000;
    font-weight: 900;
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .season-select {
    background: linear-gradient(135deg, var(--accent), #0090cc);
    color: #000;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 12px;
    padding: 4px 8px 4px 10px;
    border-radius: 20px;
    letter-spacing: 0.5px;
    border: none;
    cursor: pointer;
    appearance: none;
    -webkit-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%23000'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 8px center;
    padding-right: 22px;
  }

  .season-select option {
    background: var(--card);
    color: var(--text);
  }

  /* Round Navigator */
  .round-nav {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
  }

  .round-nav-btn {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 1px solid var(--border);
    background: var(--card);
    color: var(--text);
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    flex-shrink: 0;
  }

  .round-nav-btn:hover:not(:disabled) {
    background: var(--accent);
    color: #000;
    border-color: var(--accent);
  }

  .round-nav-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .round-nav-label {
    flex: 1;
    text-align: center;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 15px;
    color: var(--text);
    letter-spacing: 0.5px;
  }

  .round-nav-sub {
    font-size: 11px;
    color: var(--muted);
    font-weight: 600;
    letter-spacing: 0;
  }

  .round-pills {
    display: flex;
    gap: 4px;
    overflow-x: auto;
    scrollbar-width: none;
    padding: 2px 0;
  }

  .round-pills::-webkit-scrollbar { display: none; }

  .round-pill {
    flex-shrink: 0;
    padding: 4px 10px;
    border-radius: 12px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 12px;
    font-weight: 700;
    color: var(--muted);
    background: var(--card);
    border: 1px solid var(--border);
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .round-pill:hover { border-color: var(--accent); color: var(--text-secondary); }
  .round-pill.active {
    background: var(--accent);
    border-color: var(--accent);
    color: #000;
  }

  .live-indicator {
    display: flex;
    align-items: center;
    gap: 5px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 11px;
    font-weight: 700;
    color: var(--green);
    letter-spacing: 0.5px;
  }

  .live-dot {
    width: 7px;
    height: 7px;
    background: var(--green);
    border-radius: 50%;
    animation: pulse 1.5s infinite;
    box-shadow: 0 0 6px var(--green);
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.4; transform: scale(1.4); }
  }

  /* NAV TABS */
  .nav-tabs {
    display: flex;
    gap: 0;
  }

  .nav-tab {
    padding: 10px 18px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 13px;
    color: var(--muted);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    white-space: nowrap;
  }

  .nav-tab:hover { color: var(--text-secondary); }
  .nav-tab.active {
    color: var(--accent);
    border-bottom-color: var(--accent);
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     VIEWS
     ═══════════════════════════════════════════════════════════════════════════ */
  .view {
    display: none;
    padding: 16px;
    max-width: 600px;
    margin: 0 auto;
    padding-bottom: 40px;
  }

  .view.active { display: block; }

  /* ═══════════════════════════════════════════════════════════════════════════
     DASHBOARD VIEW
     ═══════════════════════════════════════════════════════════════════════════ */

  /* Season Hero Banner */
  .hero-banner {
    background: linear-gradient(135deg, #0d1a2e 0%, #0a1220 50%, #111822 100%);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 24px 20px;
    position: relative;
    overflow: hidden;
    margin-bottom: 16px;
  }

  .hero-banner::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--accent), var(--accent2), var(--accent));
  }

  .hero-banner::after {
    content: '';
    position: absolute;
    top: -50%; right: -20%;
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, rgba(0,200,255,0.06) 0%, transparent 70%);
    pointer-events: none;
  }

  .hero-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 32px;
    letter-spacing: -0.5px;
    margin-bottom: 4px;
    position: relative;
  }

  .hero-title span { color: var(--accent); }

  .hero-sub {
    font-size: 14px;
    color: var(--text-secondary);
    font-weight: 500;
    position: relative;
  }

  .hero-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-top: 20px;
    position: relative;
  }

  .hero-stat {
    background: rgba(0,0,0,0.3);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 12px;
    text-align: center;
  }

  .hero-stat-value {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 24px;
    color: var(--accent);
    line-height: 1;
  }

  .hero-stat-label {
    font-size: 10px;
    color: var(--muted);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin-top: 4px;
  }

  /* Live Scores Ticker */
  .section-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 14px;
    color: var(--label);
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .section-label .count {
    background: var(--accent-dim);
    color: var(--accent);
    font-size: 11px;
    padding: 2px 7px;
    border-radius: 10px;
  }

  .scores-ticker {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding-bottom: 4px;
    scrollbar-width: none;
    margin-bottom: 16px;
  }

  .scores-ticker::-webkit-scrollbar { display: none; }

  .score-card {
    flex-shrink: 0;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 12px 14px;
    min-width: 180px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
  }

  .score-card:hover {
    border-color: var(--accent);
    background: var(--card-hover);
    transform: translateY(-1px);
  }

  .score-card.live {
    border-color: rgba(0,230,118,0.3);
  }

  .score-card.live::before {
    content: 'LIVE';
    position: absolute;
    top: 6px;
    right: 8px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 9px;
    font-weight: 800;
    color: var(--green);
    letter-spacing: 1px;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .score-card.live::after {
    content: '';
    position: absolute;
    top: 10px;
    right: 34px;
    width: 5px;
    height: 5px;
    background: var(--green);
    border-radius: 50%;
    animation: pulse 1.5s infinite;
  }

  .score-card-status {
    font-size: 10px;
    color: var(--muted);
    font-weight: 600;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .score-card-teams {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .score-team-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
  }

  .score-team-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 14px;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .score-team-dot {
    width: 8px;
    height: 8px;
    border-radius: 2px;
    flex-shrink: 0;
  }

  .score-team-score {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 16px;
    color: var(--text);
    min-width: 28px;
    text-align: right;
  }

  .score-team-row.winner .score-team-score { color: var(--accent); }

  /* Ladder Snapshot */
  .ladder-snapshot {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    margin-bottom: 16px;
  }

  .ladder-snapshot-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 14px;
    border-bottom: 1px solid var(--border);
  }

  .ladder-snapshot-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 14px;
    color: var(--label);
    letter-spacing: 0.8px;
    text-transform: uppercase;
  }

  .view-all-btn {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 11px;
    font-weight: 700;
    color: var(--accent);
    cursor: pointer;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    background: none;
    border: none;
    padding: 4px 8px;
  }

  .ladder-row {
    display: grid;
    grid-template-columns: 28px 1fr 44px 44px 50px;
    align-items: center;
    padding: 10px 14px;
    border-bottom: 1px solid rgba(26,35,50,0.6);
    gap: 8px;
    transition: background 0.15s;
  }

  .ladder-row:hover { background: rgba(0,200,255,0.03); }
  .ladder-row:last-child { border-bottom: none; }

  .ladder-row.top-4 { background: rgba(0,230,118,0.03); }
  .ladder-row.top-8 { background: rgba(0,200,255,0.02); }

  .ladder-pos {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 14px;
    color: var(--muted);
    text-align: center;
  }

  .ladder-row.top-4 .ladder-pos { color: var(--green); }

  .ladder-team {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .ladder-team-dot {
    width: 10px;
    height: 10px;
    border-radius: 3px;
    flex-shrink: 0;
  }

  .ladder-team-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 14px;
    color: var(--text);
  }

  .ladder-wl {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 13px;
    font-weight: 600;
    color: var(--text-secondary);
    text-align: center;
  }

  .ladder-pct {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 13px;
    font-weight: 700;
    color: var(--accent);
    text-align: right;
  }

  .ladder-pts {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 14px;
    font-weight: 800;
    color: var(--text);
    text-align: center;
  }

  .ladder-header-row {
    display: grid;
    grid-template-columns: 28px 1fr 44px 44px 50px;
    padding: 6px 14px;
    gap: 8px;
    border-bottom: 1px solid var(--border);
    background: rgba(0,0,0,0.2);
  }

  .ladder-header-row span {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 10px;
    font-weight: 700;
    color: var(--muted);
    letter-spacing: 0.8px;
    text-transform: uppercase;
  }

  .ladder-header-row span:nth-child(4),
  .ladder-header-row span:nth-child(5) { text-align: center; }
  .ladder-header-row span:last-child { text-align: right; }

  /* ═══════════════════════════════════════════════════════════════════════════
     MATCHES VIEW
     ═══════════════════════════════════════════════════════════════════════════ */
  .game-tabs {
    display: flex;
    gap: 8px;
    overflow-x: auto;
    padding-bottom: 14px;
    scrollbar-width: none;
    margin-bottom: 4px;
  }
  .game-tabs::-webkit-scrollbar { display: none; }

  .game-tab {
    flex-shrink: 0;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 10px 14px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 13px;
    color: var(--label);
    white-space: nowrap;
  }

  .game-tab:hover { border-color: var(--accent); }
  .game-tab.active {
    background: var(--accent);
    border-color: var(--accent);
    color: #000;
  }

  /* Match Hero Card */
  .match-hero {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    position: relative;
    margin-bottom: 14px;
  }

  .match-hero::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
  }

  .match-header {
    padding: 14px 16px 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .match-info {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 11px;
    font-weight: 600;
    color: var(--muted);
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  .match-time {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 11px;
    font-weight: 700;
    color: var(--accent);
    letter-spacing: 0.5px;
  }

  .teams-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 4px 16px 16px;
    gap: 12px;
  }

  .team-block {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }

  .team-logo-wrap {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 16px;
    letter-spacing: -0.5px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    transition: transform 0.3s;
  }

  .team-logo-wrap:hover { transform: scale(1.05); }

  .team-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 15px;
    text-align: center;
    color: var(--text);
  }

  .team-form {
    display: flex;
    gap: 3px;
  }

  .form-dot {
    width: 16px;
    height: 16px;
    border-radius: 4px;
    font-size: 8px;
    font-weight: 800;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Barlow Condensed', sans-serif;
    transition: transform 0.2s;
  }

  .form-dot:hover { transform: scale(1.15); }
  .form-dot.w { background: var(--green); color: #000; }
  .form-dot.l { background: var(--red-dim); color: var(--red); border: 1px solid rgba(255,68,68,0.3); }
  .form-dot.d { background: var(--yellow-dim); color: var(--yellow); border: 1px solid rgba(255,214,0,0.3); }

  .vs-block {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
  }

  .vs-text {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 22px;
    color: var(--muted);
  }

  .venue-text {
    font-size: 10px;
    color: var(--muted);
    font-weight: 500;
    text-align: center;
    max-width: 80px;
    line-height: 1.3;
  }

  /* Win Probability Bar */
  .prob-section {
    border-top: 1px solid var(--border);
    padding: 14px 16px;
  }

  .prob-label {
    display: flex;
    justify-content: space-between;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 11px;
    font-weight: 700;
    margin-bottom: 8px;
    color: var(--label);
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }

  .prob-bar-container {
    position: relative;
    height: 28px;
    border-radius: 14px;
    background: var(--border);
    overflow: hidden;
    display: flex;
  }

  .prob-bar-home {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), #0090cc);
    transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 45px;
    position: relative;
  }

  .prob-bar-away {
    height: 100%;
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 45px;
  }

  .prob-bar-pct {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 13px;
    color: #000;
    position: relative;
    z-index: 1;
  }

  .prob-bar-away .prob-bar-pct {
    color: var(--label);
  }

  /* Predicted Score */
  .pred-score {
    border-top: 1px solid var(--border);
    padding: 14px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .pred-score-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 11px;
    font-weight: 700;
    color: var(--muted);
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  .pred-score-values {
    display: flex;
    gap: 16px;
    align-items: center;
  }

  .pred-score-team { text-align: center; }

  .pred-score-num {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 30px;
    line-height: 1;
    color: var(--text);
  }

  .pred-score-num.loser { color: var(--muted); }

  .pred-score-team-name {
    font-size: 10px;
    color: var(--muted);
    font-weight: 600;
    margin-top: 4px;
    font-family: 'Barlow Condensed', sans-serif;
    letter-spacing: 0.5px;
  }

  .pred-score-dash {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 20px;
    color: var(--border-light);
  }

  .confidence-chip {
    background: var(--green-dim);
    border: 1px solid rgba(0, 230, 118, 0.3);
    color: var(--green);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 11px;
    font-weight: 800;
    padding: 4px 10px;
    border-radius: 20px;
    letter-spacing: 0.5px;
  }

  .confidence-chip.medium {
    background: var(--yellow-dim);
    border-color: rgba(255, 214, 0, 0.3);
    color: var(--yellow);
  }

  .confidence-chip.low {
    background: var(--red-dim);
    border-color: rgba(255, 68, 68, 0.3);
    color: var(--red);
  }

  /* Insight Card */
  .insight-card {
    background: linear-gradient(135deg, rgba(0,200,255,0.06), rgba(255,107,53,0.04));
    border: 1px solid rgba(0,200,255,0.15);
    border-radius: var(--radius);
    padding: 14px 16px;
    display: flex;
    gap: 12px;
    align-items: flex-start;
    margin-bottom: 14px;
  }

  .insight-icon {
    width: 36px;
    height: 36px;
    background: var(--accent-dim);
    border-radius: var(--radius-xs);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
  }

  .insight-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 13px;
    color: var(--accent);
    margin-bottom: 4px;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }

  .insight-text {
    font-size: 13px;
    color: var(--text-secondary);
    line-height: 1.5;
  }

  /* Cards */
  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    margin-bottom: 14px;
  }

  .card-title {
    padding: 12px 14px 10px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 13px;
    color: var(--label);
    letter-spacing: 0.8px;
    text-transform: uppercase;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  /* Factor Rows */
  .factor-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 14px;
    border-bottom: 1px solid rgba(26,35,50,0.5);
    gap: 8px;
  }

  .factor-row:last-child { border-bottom: none; }

  .factor-name {
    font-size: 13px;
    font-weight: 500;
    color: var(--label);
    flex: 1;
  }

  .factor-chip {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 12px;
    font-weight: 700;
    padding: 3px 8px;
    border-radius: 4px;
  }

  .factor-chip.win { background: var(--green-dim); color: var(--green); }
  .factor-chip.lose { background: var(--red-dim); color: var(--red); }
  .factor-chip.draw { background: rgba(90,100,120,0.15); color: var(--muted); }

  .factor-edge {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 12px;
    min-width: 44px;
    text-align: right;
    letter-spacing: 0.5px;
  }

  .factor-edge.high { color: var(--green); }
  .factor-edge.mid { color: var(--yellow); }
  .factor-edge.low { color: var(--muted); }

  /* Market Rows */
  .market-row {
    display: flex;
    align-items: center;
    padding: 12px 14px;
    border-bottom: 1px solid rgba(26,35,50,0.5);
    gap: 10px;
    cursor: pointer;
    transition: background 0.15s;
    position: relative;
  }

  .market-row:last-child { border-bottom: none; }
  .market-row:hover { background: rgba(0,200,255,0.03); }

  .market-row.recommended {
    background: rgba(0,200,255,0.04);
  }

  .rec-badge {
    background: var(--accent);
    color: #000;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 9px;
    font-weight: 800;
    padding: 2px 6px;
    border-radius: 4px;
    letter-spacing: 0.5px;
    flex-shrink: 0;
  }

  .market-team-logo {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .market-bet-info { flex: 1; min-width: 0; }

  .market-bet-name {
    font-weight: 600;
    font-size: 14px;
    color: var(--text);
  }

  .market-bet-sub {
    font-size: 11px;
    color: var(--muted);
    font-weight: 400;
    margin-top: 1px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .market-odds {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-xs);
    padding: 6px 12px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 16px;
    color: var(--text);
    min-width: 50px;
    text-align: center;
    transition: all 0.15s;
    flex-shrink: 0;
  }

  .market-odds:hover {
    background: var(--accent);
    border-color: var(--accent);
    color: #000;
  }

  /* Squiggle Models Card */
  .models-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1px;
    background: var(--border);
  }

  .model-cell {
    background: var(--card);
    padding: 10px 12px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .model-name {
    font-size: 12px;
    color: var(--text-secondary);
    font-weight: 500;
  }

  .model-tip {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 13px;
  }

  .model-tip.home { color: var(--accent); }
  .model-tip.away { color: var(--accent2); }

  /* ═══════════════════════════════════════════════════════════════════════════
     LADDER VIEW (FULL)
     ═══════════════════════════════════════════════════════════════════════════ */
  .ladder-full {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
  }

  .ladder-full-header {
    display: grid;
    grid-template-columns: 30px 1fr 36px 36px 36px 52px 52px;
    padding: 8px 12px;
    gap: 4px;
    border-bottom: 1px solid var(--border);
    background: rgba(0,0,0,0.3);
  }

  .ladder-full-header span {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 10px;
    font-weight: 700;
    color: var(--muted);
    letter-spacing: 0.6px;
    text-align: center;
  }

  .ladder-full-header span:nth-child(2) { text-align: left; }
  .ladder-full-header span:last-child { text-align: right; }

  .ladder-full-row {
    display: grid;
    grid-template-columns: 30px 1fr 36px 36px 36px 52px 52px;
    align-items: center;
    padding: 10px 12px;
    gap: 4px;
    border-bottom: 1px solid rgba(26,35,50,0.5);
    transition: background 0.15s;
  }

  .ladder-full-row:hover { background: rgba(0,200,255,0.03); }
  .ladder-full-row:last-child { border-bottom: none; }

  .ladder-full-row.finals-zone {
    border-bottom: 2px solid rgba(0,230,118,0.3);
  }

  .lf-pos {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 14px;
    text-align: center;
  }

  .lf-team {
    display: flex;
    align-items: center;
    gap: 8px;
    min-width: 0;
  }

  .lf-team-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 13px;
    color: var(--text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .lf-stat {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 13px;
    font-weight: 600;
    color: var(--text-secondary);
    text-align: center;
  }

  .lf-pct {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 13px;
    font-weight: 700;
    color: var(--accent);
    text-align: center;
  }

  .lf-pts {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 15px;
    font-weight: 900;
    color: var(--text);
    text-align: right;
  }

  .lf-form {
    display: flex;
    gap: 2px;
    justify-content: center;
  }

  .lf-form-dot {
    width: 12px;
    height: 12px;
    border-radius: 3px;
    font-size: 7px;
    font-weight: 800;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Barlow Condensed', sans-serif;
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     STATS VIEW
     ═══════════════════════════════════════════════════════════════════════════ */
  .stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 16px;
  }

  .stat-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 16px 14px;
    text-align: center;
    transition: all 0.2s;
  }

  .stat-card:hover {
    border-color: var(--accent);
    transform: translateY(-1px);
  }

  .stat-card-value {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 28px;
    color: var(--text);
    line-height: 1;
  }

  .stat-card-value .unit {
    font-size: 14px;
    color: var(--muted);
    font-weight: 600;
  }

  .stat-card-label {
    font-size: 11px;
    color: var(--muted);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin-top: 6px;
  }

  .stat-card.accent .stat-card-value { color: var(--accent); }
  .stat-card.green .stat-card-value { color: var(--green); }
  .stat-card.orange .stat-card-value { color: var(--accent2); }

  /* Season Leaders */
  .leader-row {
    display: flex;
    align-items: center;
    padding: 12px 14px;
    border-bottom: 1px solid rgba(26,35,50,0.5);
    gap: 12px;
    transition: background 0.15s;
  }

  .leader-row:last-child { border-bottom: none; }
  .leader-row:hover { background: rgba(0,200,255,0.03); }

  .leader-rank {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 16px;
    color: var(--muted);
    min-width: 20px;
    text-align: center;
  }

  .leader-rank.gold { color: var(--yellow); }
  .leader-rank.silver { color: #adb5bd; }
  .leader-rank.bronze { color: #cd7f32; }

  .leader-avatar {
    width: 38px;
    height: 38px;
    border-radius: 50%;
    background: var(--surface);
    border: 2px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 12px;
    color: var(--accent);
    flex-shrink: 0;
  }

  .leader-info { flex: 1; min-width: 0; }

  .leader-name {
    font-weight: 700;
    font-size: 14px;
    color: var(--text);
  }

  .leader-team {
    font-size: 11px;
    color: var(--muted);
    margin-top: 1px;
  }

  .leader-stat {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 18px;
    color: var(--accent);
    flex-shrink: 0;
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     LOADING & EMPTY STATES
     ═══════════════════════════════════════════════════════════════════════════ */
  .loading-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 20px;
    text-align: center;
  }

  .loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin-bottom: 16px;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .loading-text {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 14px;
    color: var(--muted);
    letter-spacing: 0.5px;
  }

  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--muted);
  }

  .empty-state-icon {
    font-size: 40px;
    margin-bottom: 12px;
    opacity: 0.5;
  }

  .empty-state-text {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 16px;
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 4px;
  }

  .empty-state-sub {
    font-size: 13px;
    color: var(--muted);
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     DISCLAIMER
     ═══════════════════════════════════════════════════════════════════════════ */
  .disclaimer {
    text-align: center;
    font-size: 10px;
    color: var(--muted);
    padding: 20px 16px 30px;
    line-height: 1.6;
    opacity: 0.6;
  }

  .disclaimer a {
    color: var(--accent);
    text-decoration: none;
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     ANIMATIONS
     ═══════════════════════════════════════════════════════════════════════════ */
  @keyframes fadeSlideUp {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .anim-in {
    animation: fadeSlideUp 0.35s cubic-bezier(0.4, 0, 0.2, 1) both;
  }

  .anim-in:nth-child(1) { animation-delay: 0.03s; }
  .anim-in:nth-child(2) { animation-delay: 0.06s; }
  .anim-in:nth-child(3) { animation-delay: 0.09s; }
  .anim-in:nth-child(4) { animation-delay: 0.12s; }
  .anim-in:nth-child(5) { animation-delay: 0.15s; }
  .anim-in:nth-child(6) { animation-delay: 0.18s; }
  .anim-in:nth-child(7) { animation-delay: 0.21s; }
  .anim-in:nth-child(8) { animation-delay: 0.24s; }

  /* ═══════════════════════════════════════════════════════════════════════════
     TEAM COLOURS
     ═══════════════════════════════════════════════════════════════════════════ */
  .tc-ade { background: linear-gradient(135deg, #002b5c, #ffd700); color: #fff; }
  .tc-bri { background: linear-gradient(135deg, #7b0042, #002b5c); color: #ffd700; }
  .tc-car { background: linear-gradient(135deg, #001f5b, #000d30); color: #fff; }
  .tc-col { background: linear-gradient(135deg, #222, #000); color: #fff; border: 1px solid #444; }
  .tc-ess { background: linear-gradient(135deg, #cc0000, #000); color: #fff; }
  .tc-fre { background: linear-gradient(135deg, #5c2d91, #3d1560); color: #fff; }
  .tc-gee { background: linear-gradient(135deg, #003087, #001a4d); color: #fff; }
  .tc-gcs { background: linear-gradient(135deg, #d4001e, #ffd700); color: #fff; }
  .tc-gws { background: linear-gradient(135deg, #f47920, #c85000); color: #fff; }
  .tc-haw { background: linear-gradient(135deg, #4d2004, #fbbf24); color: #fff; }
  .tc-mel { background: linear-gradient(135deg, #001f5b, #cc0000); color: #fff; }
  .tc-nme { background: linear-gradient(135deg, #003da5, #001a4d); color: #fff; }
  .tc-pta { background: linear-gradient(135deg, #008aaa, #000); color: #fff; }
  .tc-ric { background: linear-gradient(135deg, #ffd700, #000); color: #000; }
  .tc-stk { background: linear-gradient(135deg, #cc0000, #000); color: #fff; }
  .tc-syd { background: linear-gradient(135deg, #d40000, #800000); color: #fff; }
  .tc-wce { background: linear-gradient(135deg, #002b5c, #ffd700); color: #fff; }
  .tc-wbd { background: linear-gradient(135deg, #001f5b, #cc0000); color: #fff; }

  /* Dot colours (for score cards / ladder) */
  .dot-ade { background: #002b5c; } .dot-bri { background: #7b0042; }
  .dot-car { background: #001f5b; } .dot-col { background: #222; }
  .dot-ess { background: #cc0000; } .dot-fre { background: #5c2d91; }
  .dot-gee { background: #003087; } .dot-gcs { background: #d4001e; }
  .dot-gws { background: #f47920; } .dot-haw { background: #4d2004; }
  .dot-mel { background: #001f5b; } .dot-nme { background: #003da5; }
  .dot-pta { background: #008aaa; } .dot-ric { background: #ffd700; }
  .dot-stk { background: #cc0000; } .dot-syd { background: #d40000; }
  .dot-wce { background: #002b5c; } .dot-wbd { background: #001f5b; }

  @media (min-width: 500px) {
    .hero-stats { grid-template-columns: repeat(3, 1fr); }
    .stats-grid { grid-template-columns: repeat(2, 1fr); }
  }

  @media (min-width: 650px) {
    .view { max-width: 640px; }
  }
</style>
</head>
<body>

<!-- ═══════════════════════════════════════════════════════════════════════════
     HEADER
     ═══════════════════════════════════════════════════════════════════════════ -->
<header>
  <div class="header-top">
    <div class="logo">
      <div class="logo-icon">E</div>
      AFL<span>Edge</span>
    </div>
    <div class="header-right">
      <div class="live-indicator" id="live-indicator" style="display:none">
        <div class="live-dot"></div>
        LIVE
      </div>
      <select class="season-select" id="season-select" onchange="changeSeason(this.value)">
        <option value="2026">2026</option>
        <option value="2025" selected>2025</option>
        <option value="2024">2024</option>
        <option value="2023">2023</option>
      </select>
    </div>
  </div>
  <div class="nav-tabs" id="nav-tabs">
    <div class="nav-tab active" data-view="dashboard">Dashboard</div>
    <div class="nav-tab" data-view="matches">Matches</div>
    <div class="nav-tab" data-view="ladder">Ladder</div>
    <div class="nav-tab" data-view="stats">Stats</div>
  </div>
</header>

<!-- ═══════════════════════════════════════════════════════════════════════════
     DASHBOARD VIEW
     ═══════════════════════════════════════════════════════════════════════════ -->
<div class="view active" id="view-dashboard">

  <!-- Hero Banner -->
  <div class="hero-banner anim-in">
    <div class="hero-title" id="hero-title">2025 <span>Season</span></div>
    <div class="hero-sub" id="hero-sub">Connecting to Squiggle API...</div>
    <div class="hero-stats" id="hero-stats">
      <div class="hero-stat">
        <div class="hero-stat-value" id="stat-round">--</div>
        <div class="hero-stat-label">Current Round</div>
      </div>
      <div class="hero-stat">
        <div class="hero-stat-value" id="stat-games">--</div>
        <div class="hero-stat-label">Games Played</div>
      </div>
      <div class="hero-stat">
        <div class="hero-stat-value" id="stat-upcoming">--</div>
        <div class="hero-stat-label">This Round</div>
      </div>
    </div>
  </div>

  <!-- Round Navigator -->
  <div class="round-nav anim-in" id="round-nav">
    <button class="round-nav-btn" id="round-prev" onclick="changeRound(-1)">&lt;</button>
    <div class="round-nav-label" id="round-nav-label">
      Round --
      <div class="round-nav-sub" id="round-nav-sub">Loading...</div>
    </div>
    <button class="round-nav-btn" id="round-next" onclick="changeRound(1)">&gt;</button>
  </div>

  <!-- Round Pills (quick jump) -->
  <div class="round-pills anim-in" id="round-pills"></div>

  <!-- Scores for selected round -->
  <div class="section-label anim-in" style="margin-top:12px">
    Round Matches <span class="count" id="round-count">0</span>
  </div>
  <div class="scores-ticker anim-in" id="scores-ticker">
    <div class="loading-state" style="width:100%">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading scores...</div>
    </div>
  </div>

  <!-- Ladder Snapshot (Top 8) -->
  <div class="ladder-snapshot anim-in" id="ladder-snapshot">
    <div class="ladder-snapshot-header">
      <div class="ladder-snapshot-title">Ladder</div>
      <button class="view-all-btn" onclick="switchView('ladder')">View Full Ladder</button>
    </div>
    <div class="ladder-header-row">
      <span>#</span><span>Team</span><span>W</span><span>L</span><span>Pts</span>
    </div>
    <div id="ladder-snapshot-body">
      <div class="loading-state" style="padding:30px">
        <div class="loading-spinner"></div>
      </div>
    </div>
  </div>

  <div class="disclaimer">
    AFL Edge uses the free <a href="https://squiggle.com.au" target="_blank">Squiggle API</a> for live data and predictions from 16+ expert models.<br>
    This is not financial advice. Please gamble responsibly. 1800 858 858.
  </div>
</div>

<!-- ═══════════════════════════════════════════════════════════════════════════
     MATCHES VIEW
     ═══════════════════════════════════════════════════════════════════════════ -->
<div class="view" id="view-matches">

  <div class="game-tabs" id="game-tabs">
    <div class="loading-state" style="width:100%;padding:20px">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading fixtures...</div>
    </div>
  </div>

  <div id="match-content">
    <!-- Match Hero -->
    <div class="match-hero anim-in" id="match-hero" style="display:none">
      <div class="match-header">
        <div class="match-info" id="m-info">--</div>
        <div class="match-time" id="m-time">--</div>
      </div>
      <div class="teams-row">
        <div class="team-block">
          <div class="team-logo-wrap" id="m-home-logo">--</div>
          <div class="team-name" id="m-home-name">--</div>
          <div class="team-form" id="m-home-form"></div>
        </div>
        <div class="vs-block">
          <div class="vs-text">VS</div>
          <div class="venue-text" id="m-venue">--</div>
        </div>
        <div class="team-block">
          <div class="team-logo-wrap" id="m-away-logo">--</div>
          <div class="team-name" id="m-away-name">--</div>
          <div class="team-form" id="m-away-form"></div>
        </div>
      </div>

      <!-- Win Probability -->
      <div class="prob-section">
        <div class="prob-label" id="m-prob-label">
          <span>HOME WIN PROB</span><span>AWAY WIN PROB</span>
        </div>
        <div class="prob-bar-container">
          <div class="prob-bar-home" id="m-prob-home" style="width:50%">
            <span class="prob-bar-pct" id="m-prob-home-pct">50%</span>
          </div>
          <div class="prob-bar-away">
            <span class="prob-bar-pct" id="m-prob-away-pct">50%</span>
          </div>
        </div>
      </div>

      <!-- Predicted Score -->
      <div class="pred-score">
        <div>
          <div class="pred-score-label">Predicted Score</div>
          <div style="margin-top:4px"><span class="confidence-chip" id="m-confidence">--</span></div>
        </div>
        <div class="pred-score-values">
          <div class="pred-score-team">
            <div class="pred-score-num" id="m-pred-home-score">--</div>
            <div class="pred-score-team-name" id="m-pred-home-name">--</div>
          </div>
          <div class="pred-score-dash">—</div>
          <div class="pred-score-team">
            <div class="pred-score-num" id="m-pred-away-score">--</div>
            <div class="pred-score-team-name" id="m-pred-away-name">--</div>
          </div>
        </div>
      </div>
    </div>

    <!-- AI Insight -->
    <div class="insight-card anim-in" id="match-insight" style="display:none">
      <div class="insight-icon">&#x1F4A1;</div>
      <div>
        <div class="insight-title">AI Match Insight</div>
        <div class="insight-text" id="m-insight-text">--</div>
      </div>
    </div>

    <!-- Key Factors -->
    <div class="card anim-in" id="match-factors" style="display:none">
      <div class="card-title">Key Factors</div>
      <div id="m-factors-body"></div>
    </div>

    <!-- Squiggle Models -->
    <div class="card anim-in" id="match-models" style="display:none">
      <div class="card-title">
        Squiggle Model Consensus
        <span style="font-size:11px;color:var(--muted);font-weight:600" id="m-model-count"></span>
      </div>
      <div id="m-models-body"></div>
    </div>

    <!-- Head to Head Market -->
    <div class="card anim-in" id="match-h2h" style="display:none">
      <div class="card-title">Match Result</div>
      <div id="m-h2h-body"></div>
    </div>

    <!-- Line Market -->
    <div class="card anim-in" id="match-line" style="display:none">
      <div class="card-title">Line Assessment</div>
      <div id="m-line-body"></div>
    </div>

    <!-- Empty / Loading State -->
    <div id="match-loading" class="loading-state">
      <div class="loading-spinner"></div>
      <div class="loading-text">Select a match above</div>
    </div>

    <div id="match-empty" class="empty-state" style="display:none">
      <div class="empty-state-icon">&#x1F3C9;</div>
      <div class="empty-state-text">No upcoming matches</div>
      <div class="empty-state-sub">Check back closer to game day for predictions.</div>
    </div>
  </div>

  <div class="disclaimer">
    Predictions blend our 6-factor model (70%) with Squiggle's aggregate of 16+ expert models (30%).<br>
    Please gamble responsibly. 1800 858 858.
  </div>
</div>

<!-- ═══════════════════════════════════════════════════════════════════════════
     LADDER VIEW
     ═══════════════════════════════════════════════════════════════════════════ -->
<div class="view" id="view-ladder">

  <div class="section-label anim-in" id="ladder-title">AFL Ladder</div>

  <div class="ladder-full anim-in" id="ladder-full">
    <div class="ladder-full-header">
      <span>#</span><span>Team</span><span>W</span><span>L</span><span>D</span><span>%</span><span>Pts</span>
    </div>
    <div id="ladder-full-body">
      <div class="loading-state">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading ladder...</div>
      </div>
    </div>
  </div>

  <div class="disclaimer">
    Ladder data from <a href="https://squiggle.com.au" target="_blank">Squiggle API</a>. Updated every 5 minutes during match day.
  </div>
</div>

<!-- ═══════════════════════════════════════════════════════════════════════════
     STATS VIEW
     ═══════════════════════════════════════════════════════════════════════════ -->
<div class="view" id="view-stats">

  <div class="section-label anim-in">Season Overview</div>

  <div class="stats-grid anim-in" id="stats-grid">
    <div class="stat-card accent">
      <div class="stat-card-value" id="ss-total-games">--</div>
      <div class="stat-card-label">Games Played</div>
    </div>
    <div class="stat-card green">
      <div class="stat-card-value" id="ss-avg-total">--</div>
      <div class="stat-card-label">Avg Total Score</div>
    </div>
    <div class="stat-card orange">
      <div class="stat-card-value" id="ss-avg-margin">--</div>
      <div class="stat-card-label">Avg Margin</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-value" id="ss-home-win">--</div>
      <div class="stat-card-label">Home Win Rate</div>
    </div>
  </div>

  <!-- Highest Scoring Teams -->
  <div class="card anim-in">
    <div class="card-title">Highest Scoring Teams</div>
    <div id="stats-top-scoring"></div>
  </div>

  <!-- Best Defensive Teams -->
  <div class="card anim-in">
    <div class="card-title">Best Defence (Lowest Conceded)</div>
    <div id="stats-best-defence"></div>
  </div>

  <!-- Biggest Wins -->
  <div class="card anim-in">
    <div class="card-title">Biggest Wins This Season</div>
    <div id="stats-biggest-wins"></div>
  </div>

  <div class="disclaimer">
    Stats calculated from completed 2026 season games via Squiggle API.
  </div>
</div>

<!-- ═══════════════════════════════════════════════════════════════════════════
     JAVASCRIPT
     ═══════════════════════════════════════════════════════════════════════════ -->
<script>
// ─── Config ──────────────────────────────────────────────────────────────────
const API = '/api';
let currentYear = null;      // set after first API response
let currentRound = null;
let availableRounds = [];
let allGames = [];
let allStandings = [];
let upcomingMatches = [];
let currentMatchId = null;

// ─── Team Helpers ────────────────────────────────────────────────────────────
const TEAM_ABBREV = {
  'Adelaide':'ADE','Brisbane Lions':'BRI','Carlton':'CAR','Collingwood':'COL',
  'Essendon':'ESS','Fremantle':'FRE','Geelong':'GEE','Gold Coast':'GCS',
  'GWS Giants':'GWS','Hawthorn':'HAW','Melbourne':'MEL','North Melbourne':'NME',
  'Port Adelaide':'PTA','Richmond':'RIC','St Kilda':'STK','Sydney':'SYD',
  'West Coast':'WCE','Western Bulldogs':'WBD',
};

function abbrev(name) {
  return TEAM_ABBREV[name] || (name ? name.substring(0,3).toUpperCase() : '???');
}

function teamClass(name) {
  return 'tc-' + abbrev(name).toLowerCase();
}

function dotClass(name) {
  return 'dot-' + abbrev(name).toLowerCase();
}

// ─── Navigation ──────────────────────────────────────────────────────────────
document.querySelectorAll('.nav-tab').forEach(tab => {
  tab.addEventListener('click', () => switchView(tab.dataset.view));
});

function switchView(viewId) {
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.toggle('active', t.dataset.view === viewId));
  document.querySelectorAll('.view').forEach(v => v.classList.toggle('active', v.id === `view-${viewId}`));

  // Lazy-load view data
  if (viewId === 'ladder' && !document.getElementById('ladder-full-body').dataset.loaded) {
    loadLadderFull();
  }
  if (viewId === 'stats' && document.getElementById('ss-total-games').textContent === '--') {
    loadStats();
  }
  if (viewId === 'matches' && !document.getElementById('game-tabs').dataset.loaded) {
    loadMatchesView();
  }
}

// ─── Initial Load ────────────────────────────────────────────────────────────
window.addEventListener('load', () => loadSeason());

async function loadSeason(year = null, round = null) {
  try {
    // Build query params
    const upParams = new URLSearchParams();
    const ladParams = new URLSearchParams();
    if (year) { upParams.set('year', year); ladParams.set('year', year); }
    if (round) upParams.set('round', round);

    // Fetch matches + ladder in parallel — with proper error capture
    const [upResult, ladResult] = await Promise.all([
      fetch(`${API}/upcoming?${upParams}`)
        .then(async r => {
          if (!r.ok) throw new Error(`Upcoming API: ${r.status} ${r.statusText}`);
          return { ok: true, data: await r.json() };
        })
        .catch(e => ({ ok: false, error: e.message })),
      fetch(`${API}/ladder?${ladParams}`)
        .then(async r => {
          if (!r.ok) throw new Error(`Ladder API: ${r.status} ${r.statusText}`);
          return { ok: true, data: await r.json() };
        })
        .catch(e => ({ ok: false, error: e.message })),
    ]);

    // If both APIs failed, show error with details
    if (!upResult.ok && !ladResult.ok) {
      renderOfflineState(`API Error: ${upResult.error}`);
      return;
    }

    // Track which year/round the API resolved to
    const upRes = upResult.ok ? upResult.data : null;
    const ladRes = ladResult.ok ? ladResult.data : null;

    if (upRes) {
      currentYear = upRes.year;
      currentRound = upRes.round;
      availableRounds = upRes.availableRounds || [];

      // Sync the dropdown
      const select = document.getElementById('season-select');
      select.value = String(currentYear);

      upcomingMatches = upRes.matches || [];
      renderScoresTicker(upcomingMatches);
      updateHeroStats(upRes);
      renderRoundNav();
    } else {
      renderScoresTickerEmpty();
    }

    // Process ladder
    if (ladRes && ladRes.standings) {
      allStandings = ladRes.standings;
      renderLadderSnapshot(allStandings);
    }

    // Show live indicator if games in progress
    const liveGames = upcomingMatches.filter(m => m.complete > 0 && m.complete < 100);
    document.getElementById('live-indicator').style.display = liveGames.length > 0 ? 'flex' : 'none';

    // Reset other views so they reload with new season
    resetMatchesView();
    resetLadderView();
    resetStatsView();

  } catch (e) {
    console.warn('API not available:', e);
    renderOfflineState(e.message || 'Unknown error');
  }
}

// ─── Season / Round Controls ─────────────────────────────────────────────────
function changeSeason(year) {
  loadSeason(parseInt(year));
}

function changeRound(delta) {
  const idx = availableRounds.indexOf(currentRound);
  const newIdx = idx + delta;
  if (newIdx >= 0 && newIdx < availableRounds.length) {
    loadSeason(currentYear, availableRounds[newIdx]);
  }
}

function jumpToRound(round) {
  loadSeason(currentYear, round);
}

function renderRoundNav() {
  const label = document.getElementById('round-nav-label');
  const sub = document.getElementById('round-nav-sub');
  const prevBtn = document.getElementById('round-prev');
  const nextBtn = document.getElementById('round-next');

  label.innerHTML = `Round ${currentRound || '--'}<div class="round-nav-sub">${currentYear} Season · ${availableRounds.length} rounds</div>`;

  const idx = availableRounds.indexOf(currentRound);
  prevBtn.disabled = idx <= 0;
  nextBtn.disabled = idx >= availableRounds.length - 1;

  // Render round pills
  const pills = document.getElementById('round-pills');
  pills.innerHTML = availableRounds.map(r =>
    `<div class="round-pill${r === currentRound ? ' active' : ''}" onclick="jumpToRound(${r})">R${r}</div>`
  ).join('');

  // Scroll active pill into view
  setTimeout(() => {
    const active = pills.querySelector('.active');
    if (active) active.scrollIntoView({ inline: 'center', behavior: 'smooth', block: 'nearest' });
  }, 50);
}

function resetMatchesView() {
  document.getElementById('game-tabs').innerHTML = `
    <div class="loading-state" style="width:100%;padding:20px">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading fixtures...</div>
    </div>`;
  hideMatchContent();
  document.getElementById('match-loading').style.display = 'flex';
  document.getElementById('match-loading').innerHTML = `
    <div class="loading-spinner"></div>
    <div class="loading-text">Select a match above</div>`;
  document.getElementById('match-empty').style.display = 'none';
  // Mark as needing reload
  document.getElementById('game-tabs').dataset.loaded = '';
}

function resetLadderView() {
  document.getElementById('ladder-full-body').innerHTML = `
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading ladder...</div>
    </div>`;
  document.getElementById('ladder-full-body').dataset.loaded = '';
}

function resetStatsView() {
  document.getElementById('ss-total-games').textContent = '--';
  document.getElementById('ss-avg-total').textContent = '--';
  document.getElementById('ss-avg-margin').textContent = '--';
  document.getElementById('ss-home-win').textContent = '--';
}

// ─── Dashboard: Hero Stats ───────────────────────────────────────────────────
function updateHeroStats(upRes) {
  const matches = upRes.matches || [];
  const round = upRes.round || '--';
  const year = upRes.year || currentYear;
  const totalRounds = upRes.totalRounds || 0;

  document.getElementById('hero-title').innerHTML = `${year} <span>Season</span>`;
  document.getElementById('stat-round').textContent = round || '--';
  document.getElementById('stat-upcoming').textContent = matches.length;

  // Count completed games in the round
  const completed = matches.filter(m => m.complete === 100).length;
  const allDone = matches.length > 0 && completed === matches.length;

  if (allDone) {
    document.getElementById('hero-sub').textContent =
      `Round ${round} complete — ${matches.length} match${matches.length !== 1 ? 'es' : ''} played`;
  } else if (matches.length > 0) {
    document.getElementById('hero-sub').textContent =
      `Round ${round} — ${matches.length} match${matches.length !== 1 ? 'es' : ''} this round`;
  } else {
    document.getElementById('hero-sub').textContent = 'No data for this season yet';
  }

  // Estimate games played (rounds before this one * 9 games per round)
  if (round && typeof round === 'number') {
    const gamesBeforeThisRound = Math.max(0, (round - 1) * 9);
    document.getElementById('stat-games').textContent = gamesBeforeThisRound + completed;
  }
}

// ─── Dashboard: Scores Ticker ────────────────────────────────────────────────
function renderScoresTicker(matches) {
  const container = document.getElementById('scores-ticker');
  document.getElementById('round-count').textContent = matches.length;

  if (matches.length === 0) {
    renderScoresTickerEmpty();
    return;
  }

  container.innerHTML = matches.map(m => {
    const isLive = m.complete > 0 && m.complete < 100;
    const isDone = m.complete === 100;
    const hAbbr = abbrev(m.hteam);
    const aAbbr = abbrev(m.ateam);

    let status = '';
    if (isDone) status = 'FINAL';
    else if (isLive) status = `Q${Math.ceil(m.complete / 25)} · ${m.complete}%`;
    else {
      const d = new Date(m.date);
      status = d.toLocaleDateString('en-AU', { weekday:'short', day:'numeric', month:'short' }).toUpperCase();
    }

    const hWin = isDone && (m.hscore || 0) > (m.ascore || 0);
    const aWin = isDone && (m.ascore || 0) > (m.hscore || 0);

    return `
      <div class="score-card${isLive ? ' live' : ''}" onclick="goToMatch(${m.id})">
        <div class="score-card-status">${status}</div>
        <div class="score-card-teams">
          <div class="score-team-row${hWin ? ' winner' : ''}">
            <div class="score-team-name">
              <div class="score-team-dot ${dotClass(m.hteam)}"></div>
              ${hAbbr}
            </div>
            <div class="score-team-score">${isDone || isLive ? (m.hscore ?? '-') : '-'}</div>
          </div>
          <div class="score-team-row${aWin ? ' winner' : ''}">
            <div class="score-team-name">
              <div class="score-team-dot ${dotClass(m.ateam)}"></div>
              ${aAbbr}
            </div>
            <div class="score-team-score">${isDone || isLive ? (m.ascore ?? '-') : '-'}</div>
          </div>
        </div>
      </div>`;
  }).join('');
}

function renderScoresTickerEmpty() {
  document.getElementById('scores-ticker').innerHTML = `
    <div class="empty-state" style="width:100%;padding:30px">
      <div class="empty-state-text">No games this round yet</div>
      <div class="empty-state-sub">Check back closer to game day</div>
    </div>`;
}

function goToMatch(matchId) {
  switchView('matches');
  setTimeout(() => selectMatch(matchId), 100);
}

// ─── Dashboard: Ladder Snapshot ──────────────────────────────────────────────
function renderLadderSnapshot(standings) {
  const body = document.getElementById('ladder-snapshot-body');
  const sorted = [...standings].sort((a, b) => (a.rank || 99) - (b.rank || 99));
  const top8 = sorted.slice(0, 8);

  if (top8.length === 0) {
    body.innerHTML = `<div class="empty-state" style="padding:20px">
      <div class="empty-state-text">Season hasn't started yet</div>
      <div class="empty-state-sub">Ladder will populate after Round 1</div>
    </div>`;
    return;
  }

  body.innerHTML = top8.map((team, i) => {
    const pos = team.rank || (i + 1);
    const cls = pos <= 4 ? 'top-4' : 'top-8';
    const pts = (team.wins || 0) * 4 + (team.draws || 0) * 2;
    return `
      <div class="ladder-row ${cls}">
        <div class="ladder-pos">${pos}</div>
        <div class="ladder-team">
          <div class="ladder-team-dot ${dotClass(team.name)}"></div>
          <div class="ladder-team-name">${team.name}</div>
        </div>
        <div class="ladder-wl">${team.wins || 0}</div>
        <div class="ladder-wl">${team.losses || 0}</div>
        <div class="ladder-pts">${pts}</div>
      </div>`;
  }).join('');
}

// ─── Matches View ────────────────────────────────────────────────────────────
async function loadMatchesView() {
  const tabsContainer = document.getElementById('game-tabs');

  try {
    let matches = upcomingMatches;
    if (matches.length === 0) {
      const params = new URLSearchParams();
      if (currentYear) params.set('year', currentYear);
      if (currentRound) params.set('round', currentRound);
      const res = await fetch(`${API}/upcoming?${params}`).then(r => r.json());
      matches = res.matches || [];
      upcomingMatches = matches;
    }

    if (matches.length === 0) {
      tabsContainer.innerHTML = '';
      tabsContainer.dataset.loaded = 'yes';
      document.getElementById('match-loading').style.display = 'none';
      document.getElementById('match-empty').style.display = 'block';
      return;
    }

    tabsContainer.dataset.loaded = 'yes';
    tabsContainer.innerHTML = matches.slice(0, 9).map((m, i) => `
      <div class="game-tab${i === 0 ? ' active' : ''}" onclick="selectMatchTab(this, ${m.id})">
        <span>${abbrev(m.hteam)}</span><span>v</span><span>${abbrev(m.ateam)}</span>
      </div>`).join('');

    selectMatch(matches[0].id);
  } catch (e) {
    tabsContainer.innerHTML = `<div class="empty-state" style="width:100%;padding:20px">
      <div class="empty-state-text">Could not load fixtures</div>
    </div>`;
  }
}

function selectMatchTab(el, matchId) {
  document.querySelectorAll('.game-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  selectMatch(matchId);
}

async function selectMatch(matchId) {
  currentMatchId = matchId;

  // Show loading, hide content
  hideMatchContent();
  document.getElementById('match-loading').style.display = 'flex';

  try {
    const params = new URLSearchParams({ matchId });
    if (currentYear) params.set('year', currentYear);
    const res = await fetch(`${API}/predict?${params}`);
    const data = await res.json();

    if (data.error) {
      document.getElementById('match-loading').innerHTML = `
        <div class="empty-state-icon">&#x26A0;&#xFE0F;</div>
        <div class="empty-state-text">${data.error}</div>
        <div class="empty-state-sub">Predictions available after enough games have been played.</div>`;
      return;
    }

    renderMatchPrediction(data);
  } catch (e) {
    document.getElementById('match-loading').innerHTML = `
      <div class="empty-state-icon">&#x1F50C;</div>
      <div class="empty-state-text">Connection Error</div>
      <div class="empty-state-sub">Could not reach the prediction API. Try again later.</div>`;
  }
}

function hideMatchContent() {
  ['match-hero','match-insight','match-factors','match-models','match-h2h','match-line'].forEach(id => {
    document.getElementById(id).style.display = 'none';
  });
}

function renderMatchPrediction(data) {
  const m = data.match;
  const pred = data.prediction;
  const sq = data.squiggle;
  if (!pred) return;

  document.getElementById('match-loading').style.display = 'none';

  const homeProb = pred.home.winProbability;
  const awayProb = pred.away.winProbability;
  const hAbbr = abbrev(m.hteam);
  const aAbbr = abbrev(m.ateam);
  const homeWins = homeProb >= 50;

  // ── Match Hero ──
  const hero = document.getElementById('match-hero');
  hero.style.display = 'block';

  document.getElementById('m-info').textContent = `${m.venue} · ${m.roundName?.toUpperCase() || 'ROUND ' + m.round}`;
  if (m.date) {
    const d = new Date(m.date);
    document.getElementById('m-time').textContent = d.toLocaleDateString('en-AU', {
      weekday:'short', day:'numeric', month:'short', hour:'2-digit', minute:'2-digit'
    }).toUpperCase();
  }

  // Team logos
  const homeLogo = document.getElementById('m-home-logo');
  const awayLogo = document.getElementById('m-away-logo');
  homeLogo.textContent = hAbbr;
  awayLogo.textContent = aAbbr;
  homeLogo.className = `team-logo-wrap ${teamClass(m.hteam)}`;
  awayLogo.className = `team-logo-wrap ${teamClass(m.ateam)}`;

  document.getElementById('m-home-name').textContent = m.hteam;
  document.getElementById('m-away-name').textContent = m.ateam;
  document.getElementById('m-venue').textContent = m.venue;

  // Form dots
  renderFormDots('m-home-form', pred.home.team?.form || []);
  renderFormDots('m-away-form', pred.away.team?.form || []);

  // Probability bar
  document.getElementById('m-prob-label').innerHTML =
    `<span>${hAbbr} WIN PROB</span><span>${aAbbr} WIN PROB</span>`;

  const probHome = document.getElementById('m-prob-home');
  probHome.style.transition = 'none';
  probHome.style.width = '50%';
  setTimeout(() => {
    probHome.style.transition = 'width 1.2s cubic-bezier(0.4,0,0.2,1)';
    probHome.style.width = `${homeProb}%`;
  }, 50);

  document.getElementById('m-prob-home-pct').textContent = `${homeProb}%`;
  document.getElementById('m-prob-away-pct').textContent = `${awayProb}%`;

  // Predicted scores
  document.getElementById('m-pred-home-score').textContent = pred.home.predictedScore;
  document.getElementById('m-pred-away-score').textContent = pred.away.predictedScore;
  document.getElementById('m-pred-home-score').className = `pred-score-num${!homeWins ? ' loser' : ''}`;
  document.getElementById('m-pred-away-score').className = `pred-score-num${homeWins ? ' loser' : ''}`;
  document.getElementById('m-pred-home-name').textContent = hAbbr;
  document.getElementById('m-pred-away-name').textContent = aAbbr;

  // Confidence
  const conf = document.getElementById('m-confidence');
  if (pred.confidence) {
    conf.textContent = pred.confidence.label;
    conf.className = `confidence-chip${pred.confidence.color === 'yellow' ? ' medium' : pred.confidence.color === 'red' ? ' low' : ''}`;
  }

  // ── AI Insight ──
  const insightEl = document.getElementById('match-insight');
  insightEl.style.display = 'flex';

  const winner = homeWins ? m.hteam : m.ateam;
  const loser = homeWins ? m.ateam : m.hteam;
  const margin = pred.predictedMargin;
  let sqNote = '';
  if (sq && sq.modelCount > 0) {
    sqNote = ` ${sq.modelCount} Squiggle models give ${hAbbr} a ${sq.aggregateHomeWinPct?.toFixed(0)}% chance.`;
  }
  document.getElementById('m-insight-text').textContent =
    `${winner} predicted to win by ${margin} points. Form, H2H record, and venue history all favour them. ` +
    `${loser}'s recent record is working against them.` + sqNote;

  // ── Key Factors ──
  if (pred.keyFactors && pred.keyFactors.length > 0) {
    const factorsEl = document.getElementById('match-factors');
    factorsEl.style.display = 'block';
    document.getElementById('m-factors-body').innerHTML = pred.keyFactors.map(f => {
      const pct = Math.round(Math.max(f.homeEdge, f.awayEdge) * 100);
      const edgeLvl = pct >= 65 ? 'high' : pct >= 55 ? 'mid' : 'low';
      const edgeLabel = pct >= 65 ? 'HIGH' : pct >= 55 ? 'MED' : 'LOW';
      const advTeam = f.homeEdge >= f.awayEdge ? m.hteam : m.ateam;
      const chipCls = f.homeEdge >= f.awayEdge ? 'win' : 'lose';
      return `
        <div class="factor-row">
          <div class="factor-name">${f.name}</div>
          <span class="factor-chip ${chipCls}">${abbrev(advTeam)} edge</span>
          <div class="factor-edge ${edgeLvl}">${edgeLabel}</div>
        </div>`;
    }).join('');
  }

  // ── Squiggle Models ──
  if (sq && sq.modelCount > 0) {
    const modelsEl = document.getElementById('match-models');
    modelsEl.style.display = 'block';
    document.getElementById('m-model-count').textContent = `${sq.modelCount} models`;

    let modelsHTML = `<div style="padding:12px 14px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border)">
      <div style="font-size:13px;color:var(--text-secondary)">Aggregate Prediction</div>
      <div style="font-family:'Barlow Condensed';font-weight:800;font-size:16px;color:var(--accent)">
        ${hAbbr} ${sq.aggregateHomeWinPct?.toFixed(0)}%
      </div>
    </div>`;

    if (sq.tip) {
      modelsHTML += `<div style="padding:12px 14px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border)">
        <div style="font-size:13px;color:var(--text-secondary)">Tipped Winner</div>
        <div style="font-family:'Barlow Condensed';font-weight:800;font-size:14px;color:var(--green)">${sq.tip}</div>
      </div>`;
    }

    if (sq.margin) {
      modelsHTML += `<div style="padding:12px 14px;display:flex;justify-content:space-between;align-items:center">
        <div style="font-size:13px;color:var(--text-secondary)">Predicted Margin</div>
        <div style="font-family:'Barlow Condensed';font-weight:800;font-size:14px;color:var(--text)">${Math.round(sq.margin)} pts</div>
      </div>`;
    }

    document.getElementById('m-models-body').innerHTML = modelsHTML;
  }

  // ── H2H Market ──
  const h2hEl = document.getElementById('match-h2h');
  h2hEl.style.display = 'block';

  const favTeam = homeWins ? m.hteam : m.ateam;
  const dogTeam = homeWins ? m.ateam : m.hteam;
  const favProb = Math.max(homeProb, awayProb);
  const dogProb = Math.min(homeProb, awayProb);
  const favOdds = (100 / favProb).toFixed(2);
  const dogOdds = (100 / dogProb).toFixed(2);

  document.getElementById('m-h2h-body').innerHTML = `
    <div class="market-row recommended">
      <div class="market-team-logo ${teamClass(favTeam)}">${abbrev(favTeam)}</div>
      <div class="market-bet-info">
        <div class="market-bet-name">${favTeam}</div>
        <div class="market-bet-sub">Predicted win by ${margin}pts · ${favProb.toFixed(0)}% confidence</div>
      </div>
      <div class="rec-badge">PICK</div>
      <div class="market-odds">${favOdds}</div>
    </div>
    <div class="market-row">
      <div class="market-team-logo ${teamClass(dogTeam)}">${abbrev(dogTeam)}</div>
      <div class="market-bet-info">
        <div class="market-bet-name">${dogTeam}</div>
        <div class="market-bet-sub">Would need strong away performance</div>
      </div>
      <div class="market-odds">${dogOdds}</div>
    </div>`;

  // ── Line Assessment ──
  if (pred.lineAssessment) {
    const lineEl = document.getElementById('match-line');
    lineEl.style.display = 'block';
    document.getElementById('m-line-body').innerHTML = `
      <div style="padding:14px;display:flex;flex-direction:column;gap:8px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <span style="font-size:13px;color:var(--text-secondary)">Predicted Winner</span>
          <span style="font-family:'Barlow Condensed';font-weight:800;font-size:14px;color:var(--accent)">${pred.lineAssessment.predictedWinner}</span>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <span style="font-size:13px;color:var(--text-secondary)">Predicted Margin</span>
          <span style="font-family:'Barlow Condensed';font-weight:800;font-size:14px;color:var(--text)">${pred.lineAssessment.predictedMargin} pts</span>
        </div>
        <div style="margin-top:4px;padding:10px 12px;background:var(--accent-dim);border:1px solid rgba(0,200,255,0.15);border-radius:var(--radius-xs);font-size:13px;color:var(--accent);line-height:1.4">
          ${pred.lineAssessment.recommendation}
        </div>
      </div>`;
  }
}

function renderFormDots(containerId, form) {
  const el = document.getElementById(containerId);
  el.innerHTML = form.slice(0, 5).map(r => {
    const cls = r === 'W' ? 'w' : r === 'D' ? 'd' : 'l';
    return `<div class="form-dot ${cls}">${r}</div>`;
  }).join('');
}

// ─── Ladder Full View ────────────────────────────────────────────────────────
async function loadLadderFull() {
  const body = document.getElementById('ladder-full-body');
  try {
    let standings = allStandings;
    if (standings.length === 0) {
      const params = new URLSearchParams();
      if (currentYear) params.set('year', currentYear);
      const res = await fetch(`${API}/ladder?${params}`).then(r => r.json());
      standings = res.standings || [];
      allStandings = standings;
    }
    body.dataset.loaded = 'yes';
    document.getElementById('ladder-title').textContent = `${currentYear || ''} AFL Ladder`;

    if (standings.length === 0) {
      body.innerHTML = `<div class="empty-state">
        <div class="empty-state-icon">&#x1F3C6;</div>
        <div class="empty-state-text">Season hasn't started</div>
        <div class="empty-state-sub">The ladder will populate after Round 1.</div>
      </div>`;
      return;
    }

    const sorted = [...standings].sort((a, b) => (a.rank || 99) - (b.rank || 99));

    body.innerHTML = sorted.map((team, i) => {
      const pos = team.rank || (i + 1);
      const pts = (team.wins || 0) * 4 + (team.draws || 0) * 2;
      const pct = team.percentage ? team.percentage.toFixed(1) : '--';
      const isFinalsLine = pos === 8;
      const posColor = pos <= 4 ? 'color:var(--green)' : pos <= 8 ? 'color:var(--accent)' : 'color:var(--muted)';

      return `
        <div class="ladder-full-row${isFinalsLine ? ' finals-zone' : ''}">
          <div class="lf-pos" style="${posColor}">${pos}</div>
          <div class="lf-team">
            <div class="ladder-team-dot ${dotClass(team.name)}"></div>
            <div class="lf-team-name">${team.name}</div>
          </div>
          <div class="lf-stat">${team.wins || 0}</div>
          <div class="lf-stat">${team.losses || 0}</div>
          <div class="lf-stat">${team.draws || 0}</div>
          <div class="lf-pct">${pct}</div>
          <div class="lf-pts">${pts}</div>
        </div>`;
    }).join('');
  } catch (e) {
    body.innerHTML = `<div class="empty-state"><div class="empty-state-text">Could not load ladder</div></div>`;
  }
}

// ─── Stats View ──────────────────────────────────────────────────────────────
async function loadStats() {
  try {
    const params = new URLSearchParams();
    if (currentYear) params.set('year', currentYear);
    const res = await fetch(`${API}/ladder?${params}`).then(r => r.json());
    const standings = res.standings || [];
    if (standings.length === 0) {
      document.getElementById('ss-total-games').textContent = '0';
      return;
    }

    // Calculate season stats from standings
    const totalGames = standings.reduce((s, t) => s + (t.played || 0), 0) / 2;
    const totalFor = standings.reduce((s, t) => s + (t.for || 0), 0);
    const totalAgainst = standings.reduce((s, t) => s + (t.against || 0), 0);
    const avgTotal = totalGames > 0 ? ((totalFor + totalAgainst) / totalGames / 2).toFixed(0) : '--';

    // Home win rate estimation (from percentage and wins/losses)
    const totalWins = standings.reduce((s, t) => s + (t.wins || 0), 0);
    const totalPlayed = standings.reduce((s, t) => s + (t.played || 0), 0);

    // Average margin from for/against differential
    const margins = standings.map(t => Math.abs((t.for || 0) - (t.against || 0)) / Math.max(1, t.played || 1));
    const avgMargin = margins.length > 0 ? (margins.reduce((a, b) => a + b, 0) / margins.length).toFixed(0) : '--';

    document.getElementById('ss-total-games').textContent = totalGames || '--';
    document.getElementById('ss-avg-total').textContent = avgTotal;
    document.getElementById('ss-avg-margin').textContent = avgMargin;
    document.getElementById('ss-home-win').textContent = totalPlayed > 0 ? Math.round((totalWins / totalPlayed) * 100) + '%' : '--';

    // Top scoring teams
    const sorted = [...standings].sort((a, b) =>
      ((b.for || 0) / Math.max(1, b.played || 1)) - ((a.for || 0) / Math.max(1, a.played || 1))
    );

    document.getElementById('stats-top-scoring').innerHTML = sorted.slice(0, 5).map((t, i) => {
      const avg = t.played ? (t.for / t.played).toFixed(1) : '0';
      const rankCls = i === 0 ? 'gold' : i === 1 ? 'silver' : i === 2 ? 'bronze' : '';
      return `
        <div class="leader-row">
          <div class="leader-rank ${rankCls}">${i + 1}</div>
          <div class="leader-avatar" style="border-color:transparent">
            <div class="ladder-team-dot ${dotClass(t.name)}" style="width:24px;height:24px;border-radius:50%"></div>
          </div>
          <div class="leader-info">
            <div class="leader-name">${t.name}</div>
            <div class="leader-team">${t.wins || 0}W ${t.losses || 0}L · ${t.percentage?.toFixed(1) || '--'}%</div>
          </div>
          <div class="leader-stat">${avg}</div>
        </div>`;
    }).join('');

    // Best defence (lowest conceded per game)
    const defSorted = [...standings].sort((a, b) =>
      ((a.against || 0) / Math.max(1, a.played || 1)) - ((b.against || 0) / Math.max(1, b.played || 1))
    );

    document.getElementById('stats-best-defence').innerHTML = defSorted.slice(0, 5).map((t, i) => {
      const avg = t.played ? (t.against / t.played).toFixed(1) : '0';
      const rankCls = i === 0 ? 'gold' : i === 1 ? 'silver' : i === 2 ? 'bronze' : '';
      return `
        <div class="leader-row">
          <div class="leader-rank ${rankCls}">${i + 1}</div>
          <div class="leader-avatar" style="border-color:transparent">
            <div class="ladder-team-dot ${dotClass(t.name)}" style="width:24px;height:24px;border-radius:50%"></div>
          </div>
          <div class="leader-info">
            <div class="leader-name">${t.name}</div>
            <div class="leader-team">Avg ${avg} pts conceded per game</div>
          </div>
          <div class="leader-stat" style="color:var(--green)">${avg}</div>
        </div>`;
    }).join('');

    // Biggest wins — from best percentage / margin teams
    const bigWins = [...standings].sort((a, b) => (b.percentage || 0) - (a.percentage || 0));
    document.getElementById('stats-biggest-wins').innerHTML = bigWins.slice(0, 5).map((t, i) => {
      const margin = t.played ? (((t.for || 0) - (t.against || 0)) / t.played).toFixed(1) : '0';
      return `
        <div class="leader-row">
          <div class="leader-rank" style="color:${parseFloat(margin) > 0 ? 'var(--green)' : 'var(--red)'}">${i + 1}</div>
          <div class="leader-avatar" style="border-color:transparent">
            <div class="ladder-team-dot ${dotClass(t.name)}" style="width:24px;height:24px;border-radius:50%"></div>
          </div>
          <div class="leader-info">
            <div class="leader-name">${t.name}</div>
            <div class="leader-team">Avg margin: ${margin > 0 ? '+' : ''}${margin} pts/game</div>
          </div>
          <div class="leader-stat" style="color:${parseFloat(margin) > 0 ? 'var(--green)' : 'var(--red)'}">
            ${margin > 0 ? '+' : ''}${margin}
          </div>
        </div>`;
    }).join('');

  } catch (e) {
    console.error('Stats load failed:', e);
  }
}

// ─── Offline / Fallback State ────────────────────────────────────────────────
function renderOfflineState(errorMsg) {
  const detail = errorMsg || 'Could not connect to API';
  document.getElementById('hero-sub').textContent = detail;
  document.getElementById('stat-round').textContent = '--';
  document.getElementById('stat-games').textContent = '--';
  document.getElementById('stat-upcoming').textContent = '--';

  renderScoresTickerEmpty();

  document.getElementById('ladder-snapshot-body').innerHTML = `
    <div class="empty-state" style="padding:20px">
      <div class="empty-state-text">Data Unavailable</div>
      <div class="empty-state-sub" style="word-break:break-word">${detail}</div>
      <div class="empty-state-sub" style="margin-top:8px;opacity:0.6">Try <a href="/api/debug" style="color:var(--accent)" target="_blank">/api/debug</a> to test API connectivity</div>
    </div>`;
}

// ─── Auto-refresh (every 60s if live games) ──────────────────────────────────
setInterval(async () => {
  try {
    const params = new URLSearchParams();
    if (currentYear) params.set('year', currentYear);
    if (currentRound) params.set('round', currentRound);
    const r = await fetch(`${API}/upcoming?${params}`);
    if (!r.ok) return;
    const res = await r.json();
    if (res && res.matches) {
      upcomingMatches = res.matches;
      const liveGames = res.matches.filter(m => m.complete > 0 && m.complete < 100);
      document.getElementById('live-indicator').style.display = liveGames.length > 0 ? 'flex' : 'none';

      // Refresh ticker if on dashboard
      if (document.getElementById('view-dashboard').classList.contains('active')) {
        renderScoresTicker(res.matches);
      }
    }
  } catch (e) { /* silent refresh failure — ok */ }
}, 60000);
</script>
</body>
</html>
